[
  {
    "objectID": "3_04-prepping-puf-y3.html",
    "href": "3_04-prepping-puf-y3.html",
    "title": "11  Preparing Public Use Files Y3",
    "section": "",
    "text": "11.1 Load Restricted Data\nlibrary( dplyr )\n\nfpath  &lt;- \"DATA-PREP/03-year-three/03-data-final/\"\nfname  &lt;- \"YEAR-03-DATA-RESTRICTED-V04.csv\"\ndf     &lt;- read.csv( paste0( fpath, fname ) )",
    "crumbs": [
      "YEAR THREE DATA",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Preparing Public Use Files Y3</span>"
    ]
  },
  {
    "objectID": "3_04-prepping-puf-y3.html#remove-identifying-variables",
    "href": "3_04-prepping-puf-y3.html#remove-identifying-variables",
    "title": "11  Preparing Public Use Files Y3",
    "section": "11.2 Remove Identifying Variables",
    "text": "11.2 Remove Identifying Variables\nRemove all variables that:\n\nidentify the organization\nidentify individuals\ninclude long-form responses that might include details the compromise privacy\n\n\ndrop.these &lt;- \n  c(\"ExternalReference\", \"ResponseID\", \"RecipientLastName\", \"RecipientFirstName\", \n    \"RecipientEmail\", \"Completion_Status\", \"FiscalYear\", \"FiscalYear_Other\", \n    \"Name_Primary\", \"Name_Secondary\", \"Q122\", \"Q122_3_TEXT\", \"Addr_StreetLocation\", \n    \"Addr_CityState\", \"Addr_ZIP\",\n    \"PrgSrvc_OthChng_Text\", \"Staff_Other_Text_2022\", \"Staff_Other_Text_2023\", \n    \"Staff_Other_Est_NA\", \"FndRaise_Text\", \"Finance_Rev_Oth_Text\", \n    \"FinanceChng_Text\", \"LeadershipChng_Oth_Text\", \"CEOrace_Text\", \n    \"BChairrace_Text\", \"Regulations_Other_TEXT\", \"CEOrace_Text_v2022\", \n    \"BChairrace_Text_v2022\",\n    \"ContactUpdateName\", \"ContactUpdateTitle\", \n    \"ContactUpdateEmail\", \"Comments\")\n    \nkeep &lt;- \n  c(\"PrgSrvc_IncrNum\", \"PrgSrvc_DcrsNum\", \"PrgSrvc_Suspend\", \"PrgSrvc_IncrSrvc\", \n    \"PrgSrvc_DcrsSrvc\", \"PrgSrvc_NewOffc\", \"PrgSrvc_ClsdOffc\", \"PrgSrvc_IncrArea\", \n    \"PrgSrvc_DcrsArea\", \"PrgSrvc_IncrFee\", \"PrgSrvc_DcrsFee\", \"PrgSrvc_ShiftOnline\", \n    \"PrgSrvc_AddOnline\", \"PrgSrvc_Oth\", \"PplSrv_NumServed\", \"PplSrv_NumWait\", \n    \"PplSrv_NumServed_NA_X\", \"PplSrv_NumWait_NA_X\", \"Dmnd_NxtYear\", \n    \"Staff_Fulltime_2022\", \"Staff_Parttime_2022\", \"Staff_Boardmmbr_2022\", \n    \"Staff_RegVlntr_2022\", \"Staff_EpsdVltnr_2022\", \"Staff_AmerVlntr_2022\", \n    \"Staff_PdCnslt_2022\", \"Staff_Other_Est_2022\", \"Staff_Fulltime_2023\", \n    \"Staff_Parttime_2023\", \"Staff_Boardmmbr_2023\", \"Staff_RegVlntr_2023\", \n    \"Staff_EpsdVltnr_2023\", \"Staff_AmerVlntr_2023\", \"Staff_PdCnslt_2023\", \n    \"Staff_Other_Est_2023\", \"Staff_Fulltime_NA\", \"Staff_Parttime_NA\", \n    \"Staff_Boardmmbr_NA\", \"Staff_RegVlntr_NA\", \"Staff_EpsdVltnr_NA\", \n    \"Staff_AmerVlntr_NA\", \"Staff_PdCnslt_NA\",  \"Staff_Other_Text_NA\",\n    \"VolImportance\", \"DonImportance\", \"FndRaise_DvlpVirtual\", \"FndRaise_IncrExp\", \n    \"FndRaise_DcrsExp\", \"FndRaise_IncStaff\", \"FndRaise_DcrsStaff\", \n    \"FndRaise_IncrCnslt\", \"FndRaise_DcrsCnslt\", \"FndRaise_IncrVolntr\", \n    \"FndRaise_DcrsVolntr\", \"FndRaise_Othr\", \"FndRaise_MajGift_Amt\", \n    \"FndRaise_Overall_Chng\", \"FndRaise_Cashbelow250_Chng\", \"FndRaise_Cashabove250_Chng\", \n    \"FndRaise_MajGift_Chng\", \"FndRaise_Corp_Found_Grnt_Chng\", \"FndRaise_RstrGift_Chng\", \n    \"FndRaise_UnrstrGift_Chng\", \"FndRaise_DnrBlw250\", \"FndRaise_DnrAbv250\", \n    \"FndRaise_LocGvtGrnt_Seek\", \"FndRaise_StateGvtGrnt_Seek\", \"FndRaise_FedGvtGrnt_Seek\", \n    \"FndRaise_LocGvtCntrct_Seek\", \"FndRaise_StateGvtCntrct_Seek\", \n    \"FndRaise_FedGvtCntrct_Seek\", \"FndRaise_PFGrnt_Seek\", \"FndRaise_CFGrnt_Seek\", \n    \"FndRaise_DAF_Seek\", \"FndRaise_Corp_Found_Grnt_Seek\", \"FndRaise_UntdWy_Seek\", \n    \"FndRaise_CombFedCmpgn_Seek\", \"FndRaise_OthrGvngPrgrm_Seek\", \n    \"FndRaise_LocGvtGrnt_Rcv\", \"FndRaise_StateGvtGrnt_Rcv\", \"FndRaise_FedGvtGrnt_Rcv\", \n    \"FndRaise_LocGvtCntrct_Rcv\", \"FndRaise_StateGvtCntrct_Rcv\", \"FndRaise_FedGvtCntrct_Rcv\", \n    \"FndRaise_PFGrnt_Rcv\", \"FndRaise_CFGrnt_Rcv\", \"FndRaise_DAF_Rcv\", \n    \"FndRaise_Corp_Found_Grnt_Rcv\", \"FndRaise_UntdWy_Rcv\", \"FndRaise_CombFedCmpgn_Rcv\", \n    \"FndRaise_OthrGvngPrgrm_Rcv\", \"Finance_Rev_GovtMain\", \"Finance_Rev_Prtcpnt\", \n    \"Finance_Rev_IndvDon\", \"Finance_Rev_Gift\", \"Finance_Rev_Grnt\", \n    \"Finance_Rev_Spnsr\", \"Finance_Rev_Oth\", \"Reserves_Est\", \"Reserves_NA_X\", \n    \"CARES_Rcv\", \"CARES_Rcv_Est\", \"FinanceChng_Reserves\", \"FinanceChng_Borrow\", \n    \"FinanceChng_DcrsBnft\", \"FinanceChng_IncrBnft\", \"FinanceChng_IncrExp\", \n    \"FinanceChng_DcrsExp\", \"FinanceChng_Oth\", \"LeadershipChng_RetCEO\", \n    \"LeadershipChng_RsgnCEO\", \"LeadershipChng_TrmnCEO\", \"LeadershipChng_HireCEO\", \n    \"LeadershipChng_IntrmCEO\", \"LeadershipChng_ChngBC\", \"LeadershipChng_LostBoardMem\", \n    \"LeadershipChng_RplcBoardMem\", \"LeadershipChng_AddBoardMem\", \n    \"LeadershipChng_Oth\", \"CEOrace_AAPI\", \"CEOrace_Black\", \"CEOrace_Hisp\", \n    \"CEOrace_NativeAm\", \"CEOrace_White\", \"CEOrace_Oth\", \"CEOgender_Man\", \n    \"CEOgender_Woman\", \"CEOgender_Trans\", \"CEOgender_NB\", \"CEOgender_Oth\", \n    \"CEOgender_specify\", \"BChairrace_AAPI\", \"BChairrace_Black\", \"BChairrace_Hisp\", \n    \"BChairrace_NativeAm\", \"BChairrace_White\", \"BChairrace_Oth\", \n    \"BChairgender_Man\", \"BChairgender_Woman\", \"BChairgender_Trans\", \n    \"BChairgender_NB\", \"BChairgender_Oth\", \"BChairgender_specify\", \n    \"ExtAffairs_GenEd\", \"ExtAffairs_Media\", \"ExtAffairs_Advocacy\", \n    \"ExtAffairs_GovtRs\", \"ExtAffairs_DiscGovtGrnt\", \"ExtAffairs_InfoReq\", \n    \"ExtAffairs_Testify\", \"ExtAffairs_Lobby\", \"ExtAffairs_OrgPrtst\", \n    \"ExtAffairs_Mobilize\", \"ExtAffairs_Petition\", \"ExtAffairs_VoteReg\", \n    \"ExtAffairs_VoteEd\", \"Regulations\", \"Regulations_Local\", \"Regulations_State\", \n    \"Regulations_Federal\", \"Regulations_Info\", \"Regulations_Programming\", \n    \"Regulations_Forms\", \"Regulations_Requests\", \"Regulations_Advocate\", \n    \"Regulations_Research\", \"Regulations_Other\", \"PrimaryConcern\", \n    \"StaffingPlans_HireDifferent\", \"StaffingPlans_HireSame\", \"StaffingPlans_Layoff\", \n    \"StaffingPlans_SlowDown\", \"StaffingPlans_SpeedUp\", \"StaffingPlans_LoseVoluntary\", \n    \"StaffingPlans_LoseRetirement\", \"StaffingPlans_Retrain\", \"StaffingPlans_NoChange\", \n    \"StaffingPlans_DK\", \"year3wt\", \"Staff_Fulltime_2023_imp\", \n    \"Staff_Parttime_2023_imp\", \"Staff_Boardmmbr_2023_imp\", \"Staff_RegVlntr_2023_imp\", \n    \"Staff_EpsdVltnr_2023_imp\", \"Staff_AmerVlntr_2023_imp\", \"Staff_PdCnslt_2023_imp\", \n    \"CEOrace_AAPI_v2022\", \"CEOrace_Black_v2022\", \"CEOrace_Hisp_v2022\", \n    \"CEOrace_NativeAm_v2022\", \"CEOrace_White_v2022\", \"CEOrace_Oth_v2022\", \n    \"CEOgender_Man_v2022\", \"CEOgender_Woman_v2022\", \"CEOgender_Trans_v2022\", \n    \"CEOgender_NB_v2022\", \"CEOgender_Oth_v2022\", \"CEOgender_specify_v2022\", \n    \"BChairrace_AAPI_v2022\", \"BChairrace_Black_v2022\", \"BChairrace_Hisp_v2022\", \n    \"BChairrace_NativeAm_v2022\", \"BChairrace_White_v2022\", \"BChairrace_Oth_v2022\", \n    \"BChairgender_Man_v2022\", \"BChairgender_Woman_v2022\", \"BChairgender_Trans_v2022\", \n    \"BChairgender_NB_v2022\", \"BChairgender_Oth_v2022\", \"BChairgender_specify_v2022\", \n    \"CEOrace_Bi\", \"BChairrace_Bi\", \"CEOrace\", \"BChairrace\", \"CEOgender\", \n    \"BChairgender\")\n\ndf &lt;- df[keep]",
    "crumbs": [
      "YEAR THREE DATA",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Preparing Public Use Files Y3</span>"
    ]
  },
  {
    "objectID": "3_04-prepping-puf-y3.html#add-noise-to-numeric-responses",
    "href": "3_04-prepping-puf-y3.html#add-noise-to-numeric-responses",
    "title": "11  Preparing Public Use Files Y3",
    "section": "11.3 Add Noise to Numeric Responses",
    "text": "11.3 Add Noise to Numeric Responses\nAdd noise to numeric responses that could possibly be compared with public records to identify the organization.\n\n# identify numeric variables easily: \n# names(df)[ (lapply(df,class) |&gt; unlist()) != \"character\" ] |&gt; dput()\n\nfinancials &lt;-\n   c(\"PplSrv_NumServed\", \"PplSrv_NumWait\", \"Staff_Fulltime_2022\", \n    \"Staff_Parttime_2022\", \"Staff_Boardmmbr_2022\", \"Staff_RegVlntr_2022\", \n    \"Staff_EpsdVltnr_2022\", \"Staff_AmerVlntr_2022\", \"Staff_PdCnslt_2022\", \n    \"Staff_Other_Est_2022\", \"Staff_Fulltime_2023\", \"Staff_Parttime_2023\", \n    \"Staff_Boardmmbr_2023\", \"Staff_RegVlntr_2023\", \"Staff_EpsdVltnr_2023\", \n    \"Staff_AmerVlntr_2023\", \"Staff_PdCnslt_2023\", \"Staff_Other_Est_2023\", \n    \"FndRaise_MajGift_Amt\", \"FndRaise_DnrBlw250\", \"FndRaise_DnrAbv250\", \n    \"Finance_Rev_GovtMain\", \"Finance_Rev_Prtcpnt\", \"Finance_Rev_IndvDon\", \n    \"Finance_Rev_Gift\", \"Finance_Rev_Grnt\", \"Finance_Rev_Spnsr\", \n    \"Finance_Rev_Oth\", \"Reserves_Est\", \"CARES_Rcv_Est\",  \n    \"Staff_Fulltime_2023_imp\", \"Staff_Parttime_2023_imp\", \"Staff_Boardmmbr_2023_imp\", \n    \"Staff_RegVlntr_2023_imp\", \"Staff_EpsdVltnr_2023_imp\", \"Staff_AmerVlntr_2023_imp\", \n    \"Staff_PdCnslt_2023_imp\", \"CEOgender_specify_v2022\")\n\n\nadd_noise &lt;- function(x){ \n  if( is.na(x) | is.nan(x) ){ return(NA) }\n  v &lt;- x/20  # standard dev of 5% of base\n  x &lt;- rnorm( n=1, mean=x, sd=v ) |&gt; round(0)\n  return(x)\n}\n\nadd_noise( 3000 )\n\n[1] 3285\n\nmake_noise &lt;- function(x){\n  x &lt;- purrr::map_dbl( x, add_noise )\n  return(x)\n}\n\ndf2 &lt;- df  # make a copy for comparison\n\ndf[financials] &lt;- lapply( df[financials], make_noise ) \n\nmax &lt;- quantile( df$Finance_Rev_IndvDon, 0.9, na.rm=T )\n\nplot( df$Finance_Rev_IndvDon, df2$Finance_Rev_IndvDon, \n      bty=\"n\", pch=19, col=gray(0.5,0.5), cex=1.5,\n      xlim=c(0,max), ylim=c(0,max), \n      main=\"Inspect Noise\" )\n\n\n\n\n\n\n\nmax &lt;- quantile( df$Staff_Fulltime_2022, 0.9, na.rm=T )\n\nplot( df$Staff_Fulltime_2022, df2$Staff_Fulltime_2022, \n      bty=\"n\", pch=19, col=gray(0.5,0.5), cex=1.5, \n      xlim=c(0,max), ylim=c(0,max),\n      main=\"Inspect Noise\" )\n\n\n\n\n\n\n\nmax &lt;- quantile( df$Staff_Fulltime_2023, 0.9, na.rm=T )\n\nplot( df$Staff_Fulltime_2023, df$Staff_Fulltime_2023_imp, \n      bty=\"n\", pch=19, col=gray(0.5,0.5), cex=1.5, \n      xlim=c(0,max), ylim=c(0,max),\n      main=\"Inspect Noise\" )",
    "crumbs": [
      "YEAR THREE DATA",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Preparing Public Use Files Y3</span>"
    ]
  },
  {
    "objectID": "3_04-prepping-puf-y3.html#save-to-file",
    "href": "3_04-prepping-puf-y3.html#save-to-file",
    "title": "11  Preparing Public Use Files Y3",
    "section": "11.4 Save to File",
    "text": "11.4 Save to File\n\nfpath  &lt;- \"DATA-PREP/03-year-three/03-data-final/\"\nfname  &lt;- \"YEAR-03-DATA-PUF.csv\"\nwrite.csv( df, paste0( fpath, fname ), row.names=FALSE, na=\"\" )",
    "crumbs": [
      "YEAR THREE DATA",
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Preparing Public Use Files Y3</span>"
    ]
  }
]