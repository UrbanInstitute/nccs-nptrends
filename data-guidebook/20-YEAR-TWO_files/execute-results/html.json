{
  "hash": "b00c75046bce0c4b7e520c0903717467",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"YEAR TWO DATA\"\nexecute:\n  warning: false\n  message: false\n  cache: true\n---\n\n\nLoad the data needed to process the second year survey results. \n\n\n# Required R Packages\n\nThis chapter will utilize the following packages: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary( haven )\nlibrary( dplyr )\nlibrary( tidyr )\nlibrary( epoxy )\nlibrary( memisc )\nlibrary( labelled )\n```\n:::\n\n\n\n# Load the Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# LOAD DATA DICTIONARY \ndd <- \n  readxl::read_xlsx( \n   \"../data-dictionaries/dd-nptrends-wave-02.xlsx\", \n   sheet = \"data dictionary\" )\n\n# USE RAW VNAME IF VNAME IS EMPTY:\ndd$vname[ is.na(dd$vname) ] <- \n   dd$vname_raw[ is.na(dd$vname) ]\n\n# LOAD QUALTRICS SURVEY DATA \nfpath <- \"DATA-PREP/02-year-two/01-data-raw/\"\nfname <- \"wave-02-qualtrics-download-29mar23.csv\"\nsurvey_df  <- readr::read_csv( paste0( fpath, fname ) )\nsurvey_df  <- survey_df[ -(1:2), ]                      # drop qualtrics headers    \n```\n:::\n\n\nNote the raw data is challenging because it contains qualtrics encodings and missing values need context to be used correctly (e.g. were the questions skipped by skip logic, or by the respondent?). \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvey_df[ 1:6, 51:55 ] %>% pander::pander()   # data peek\n```\n\n::: {.cell-output-display}\n\n------------------------------------------------------------------------\n DemandNextYear   Staff#1_1_1   Staff#1_2_1   Staff#1_3_1   Staff#1_4_1 \n---------------- ------------- ------------- ------------- -------------\n       NA             NA            NA            NA            NA      \n\n Stay the same        15             2            12             3      \n\n    Increase           0             0             8             8      \n\n Stay the same        -99           -99           14            -99     \n\n    Increase           4             3            18            -99     \n\n    Increase           3             1            16            20      \n------------------------------------------------------------------------\n\n\n:::\n:::\n\n\n\n# Data Workflow \n\nThe following chapters describe the workflow used to import qualtrics data and apply cleaning and transformation steps to prepare the restricted use file and public use file for subsequent analysis:\n\n1.  Renaming columns\n2.  Drop nuisance columns (survey deployment attributes)\n3.  Add meaningful labels to response values \n4.  Dropping duplicates, incomplete responses and test responses\n\n\n\n\n## Renaming Columns\n\nColumns referencing survey questions are renamed with the help of a data dictionary to improve readability.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntorename <- \n  dd %>% \n  dplyr::select( vname, vname_raw ) %>% \n  tidyr::drop_na()\n```\n:::\n\n\n\n**Examples:**\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Staff#1_1_1\" \"Staff#1_2_1\" \"Staff#1_3_1\" \"Staff#1_4_1\"\n```\n\n\n:::\n:::\n\n\nGive the data meaningful names so that it is easier to work with. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nsurvey_df <- \n  survey_df %>% \n  dplyr::rename_at(\n     vars( torename$vname_raw ), \n     ~ torename$vname )\n```\n:::\n\n\n**Examples:**\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Staff_Fulltime_2021\"  \"Staff_Parttime_2021\"  \"Staff_Boardmmbr_2021\"\n[4] \"Staff_RegVlntr_2021\" \n```\n\n\n:::\n:::\n\n\n\nAdd survey questions as an attribute in the data frame: \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp          <- readr::read_csv( paste0( fpath, fname ) )\nquestion.txt  <- as.character( temp[ 1, ] )\nrm( temp )\n\nnames( question.txt ) <- names( survey_df )\nattr( survey_df, \"question_txt\" ) <- question.txt\n```\n:::\n\n\n\n## Drop Nuisance Fields \n\nMany of the exported qualtrics fields contain non-useful metadata or are empty. These have been labeled as \"DROP\" in the **group** field. Remove these for convenience. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# SELECT COLUMNS TO DROP: \nDROP_THESE <- dd$vname[ dd$group == \"DROP\" ] |> na.omit()\n\nsurvey_df <- \n  survey_df %>% \n  dplyr::select( -any_of( DROP_THESE ) )\n```\n:::\n\n\n\n\n# Groups of Variables\n\nEach group of survey questions comes with its own set of valid inputs that must be recoded separately. For example, \"N/A\"'s are options for some survey questions and not for others, and some survey questions allow for manual text inputs.\n\nThe below code chunk separates all survey questions into their respective categories before further separating each category into numeric, text or NA inputs.\n\nNA questions here refer to \"Check here if not applicable to your organization\" questions in the survey, where a \"C\" indicates that the respondent has checked the N/A box.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\n- **15** questions about **CHANGES TO PROGRAMS AND SERVICES**\n- **4** questions about the **NUMBER OF PEOPLE EACH ORGANIZATION SERVES**\n- **1** question about **OVERALL PROGRAM DEMAND**\n- **27** questions about **STAFF NUMBERS**\n- **2** questions about **DONOR AND VOLUNTEER IMPORTANCE**\n- **11** questions about **CHANGES TO LEADERSHIP**\n- **26** questions about **THE RACE AND GENDER OF CEOS AND BOARD CHAIRS**\n- **8** questions about **CHANGES TO ORGANIZATIONAL FINANCES**\n- **2** questions about **CARES FUNDING**\n- **2** questions about **FINANCIAL RESERVES**\n- **9** questions about **REVENUE SOURCES**\n- **26** questions about **FUNDRAISING SOURCES**\n- **2** questions about **DONOR TYPES IN FUNDRAISING**\n- **7** questions about **FUNDRAISING YIELDS**\n- **11** questions about **FUNDRAISING STRATEGY CHANGES**\n- **1** questions about **MAJOR GIFT AMOUNTS**\n- **13** questions about **EXTERNAL AFFAIRS**  \n- **1** questions about **FUTURE CONCERNS**\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n\n\n\n\n\n<style>\n\nh1, h2 {\n  margin-top: 80px\n}\n\n</style>\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}